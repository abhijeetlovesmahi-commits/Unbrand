<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin - School Pro SaaS</title>
    <style>
        :root { --main: #4361ee; --bg: #f4f7fe; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; display: flex; }
        
        /* Sidebar Navigation */
        .sidebar { width: 250px; background: #fff; height: 100vh; border-right: 1px solid #e0e0e0; position: fixed; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #eee; }
        .nav-links { list-style: none; padding: 20px 0; margin: 0; }
        .nav-links li { padding: 15px 25px; cursor: pointer; color: #666; transition: 0.3s; font-weight: 500; }
        .nav-links li:hover, .nav-links li.active { background: var(--main); color: #fff; border-radius: 0 30px 30px 0; margin-right: 10px; }

        /* Main Content Area */
        .main-content { margin-left: 250px; padding: 30px; width: 100%; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Modern Cards */
        .card { background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-top: 5px; box-sizing: border-box; }
        .btn { background: var(--main); color: #fff; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <img id="side-logo" src="" style="width: 50px; border-radius: 50%;">
            <h3 id="side-name">School Admin</h3>
        </div>
        <ul class="nav-links">
            <li class="active" onclick="showTab('dashboard')">üè† Dashboard</li>
            <li onclick="showTab('branding')">üé® Branding</li>
            <li onclick="showTab('website')">üåê Website Control</li>
            <li onclick="showTab('students')">üë§ Students & Attendance</li>
            <li onclick="showTab('homework')">üìù Homework & News</li>
            <li onclick="logout()" style="color: #ff4757;">üö™ Logout</li>
        </ul>
    </div>

    <div class="main-content">
        
        <div id="dashboard" class="tab-content active">
            <h2>Welcome Back, <span id="welcome-name">Admin</span></h2>
            <div class="grid-3">
                <div class="card"><h3>Total Students</h3><p id="total-stu">0</p></div>
                <div class="card"><h3>Today's Notice</h3><p id="total-notices">0</p></div>
                <div class="card"><h3>Staff Count</h3><p>--</p></div>
            </div>
        </div>

        <div id="branding" class="tab-content">
            <div class="card">
                <h2>üé® Master Branding</h2>
                <div class="form-group">
                    <label>School Name</label>
                    <input type="text" id="sName" placeholder="Enter Full Name">
                </div>
                <div class="form-group">
                    <label>Theme Color</label>
                    <input type="color" id="sColor" value="#4361ee">
                </div>
                <button class="btn" onclick="saveBrand()">Update All Branding</button>
            </div>
        </div>

        <div id="website" class="tab-content">
            <div class="card">
                <h2>üåê Website Content Manager</h2>
                <div class="form-group">
                    <label>Latest Notice (Scroll on Website)</label>
                    <textarea id="noticeText" rows="3" placeholder="Admission Open for 2026..."></textarea>
                </div>
                <div class="form-group">
                    <label>Current Vacancies</label>
                    <input type="text" id="vacancy" placeholder="Needed: Math Teacher (Apply at Office)">
                </div>
                <button class="btn" onclick="updateWebsite()">Publish to Public Website</button>
            </div>
        </div>

        <div id="students" class="tab-content">
            <div class="card">
                <button class="btn" onclick="location.href='admission.html'">‚ûï New Admission</button>
                <table>
                    <thead>
                        <tr><th>ID</th><th>Name</th><th>Class</th><th>Action</th></tr>
                    </thead>
                    <tbody id="student-table"></tbody>
                </table>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, collection } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD66kWwzsUS4iOZ-4ssE9w9kG1N4fBOOzk",
            authDomain: "abhijeet-69d56.firebaseapp.com",
            projectId: "abhijeet-69d56",
            appId: "1:490125802939:web:3fda6b6b9b4c1af984d89e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- UI Navigation ---
        window.showTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-links li').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        };

        // --- Dynamic Branding Load ---
        onSnapshot(doc(db, "appSettings", "branding"), (snap) => {
            if(snap.exists()){
                const d = snap.data();
                document.getElementById('side-name').innerText = d.schoolName;
                document.getElementById('side-logo').src = d.logoCode;
                document.documentElement.style.setProperty('--main', d.themeColor);
            }
        });

        // --- Load Students List ---
        onSnapshot(collection(db, "users"), (snap) => {
            const tbody = document.getElementById('student-table');
            let count = 0; tbody.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                if(u.role === "student"){
                    count++;
                    tbody.innerHTML += `<tr><td>${u.uid}</td><td>${u.name}</td><td>${u.class}</td><td><button class="btn" style="padding:5px 10px">Edit</button></td></tr>`;
                }
            });
            document.getElementById('total-stu').innerText = count;
        });

        // --- Update Website Notice ---
        window.updateWebsite = async () => {
            const n = document.getElementById('noticeText').value;
            const v = document.getElementById('vacancy').value;
            await setDoc(doc(db, "appSettings", "website"), { notice: n, vacancies: v });
            alert("Published to Public Website!");
        };

    </script>
</body>
</html>
